cmake_minimum_required(VERSION 3.8)

PROJECT(terarkdb-third-party)
SET(CMAKE_VERBOSE_MAKEFILE ON)

# Snappy
ADD_SUBDIRECTORY(snappy)
SET_PROPERTY(TARGET snappy PROPERTY POSITION_INDEPENDENT_CODE ON)

# ZLib
#ADD_SUBDIRECTORY(zlib)
#SET_PROPERTY(TARGET zlib PROPERTY POSITION_INDEPENDENT_CODE ON)

INCLUDE(ExternalProject)
# ZSTD
ExternalProject_Add(zstd-project
    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/zstd
    CONFIGURE_COMMAND ""
    BUILD_IN_SOURCE 1
    BUILD_COMMAND cd ${CMAKE_CURRENT_SOURCE_DIR}/zstd && make CXXFLAGS="-fPIC -O2" CFLAGS="-fPIC -O2"
    INSTALL_COMMAND prefix=${CMAKE_CURRENT_BINARY_DIR}/zstd make install)
ADD_LIBRARY(zstd STATIC IMPORTED GLOBAL)
ADD_DEPENDENCIES(zstd zstd-project)
SET_TARGET_PROPERTIES(zstd PROPERTIES
    IMPORTED_LOCATION ${CMAKE_CURRENT_BINARY_DIR}/zstd/lib/libzstd.a
    INCLUDE_DIRECTORIES ${CMAKE_CURRENT_BINARY_DIR}/zstd/include
    POSITION_INDEPENDENT_CODE ON)

# LZ4
ExternalProject_Add(lz4-project
    SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/lz4
    CONFIGURE_COMMAND ""
    BUILD_IN_SOURCE 1
    BUILD_COMMAND cd ${CMAKE_CURRENT_SOURCE_DIR}/lz4 && make CXXFLAGS="-fPIC -O2" CFLAGS="-fPIC -O2"
    INSTALL_COMMAND prefix=${CMAKE_CURRENT_BINARY_DIR}/lz4 make install)
ADD_LIBRARY(lz4 STATIC IMPORTED GLOBAL)
ADD_DEPENDENCIES(lz4 lz4-project)
SET_TARGET_PROPERTIES(lz4 PROPERTIES
    IMPORTED_LOCATION ${CMAKE_CURRENT_BINARY_DIR}/lz4/lib/liblz4.a
    INCLUDE_DIRECTORIES ${CMAKE_CURRENT_BINARY_DIR}/lz4/include)
